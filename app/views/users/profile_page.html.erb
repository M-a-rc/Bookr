<%= render 'layouts/navbar.html.erb', locals: { colorclass: 'navbar-contrast' }%>

<div class="container">
  <h2>Welcome back, <%= current_user.username %></h2>


  <div class="container">

    <div class="row">
      <h3>Your books</h3>
      <% @books.each do |book| %>
        <div class="col-md-3">
          <%= link_to book_path(book) do %>
            <div class="my-card mb-3">
            <%= link_to book_path(book), data: {:confirm => 'Are you sure?'}, method: :delete do %>
              <i class="fa-solid fa-circle-xmark"></i>
              <% end %>

              <div class ="my-card-upper-image" style="background-image: url(<%= image_path book.image_url %>); background-size: contain; background-position: center; background-repeat: no-repeat">
              </div>
              <hr>
              <div class="card-body">
                <h5><%= book.title %></h5>
                <p> <%= book.author %>, <%= book.publishing_date.year %> </p>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <br>
    <hr>
    <br>


    <div class="row">
      <h3>Your orders</h3>
      <% @orders.each do |order| %>
        <div class="col-md-4 card-order">
          <div class="order-card" id="<%= "order-#{order.id}"%>">
            <h5 class="text-center"> <%= order.book.title %> </h5>
            <hr>
            <p> Renter: <%= order.user.username %></p>
            <p> Message: <%= order.message %></p>
            <p> Date: <%= order.starting_date %> --> <%= order.ending_date %></p>
            <hr>
              <% case order.status %>
              <% when 'pending' %>
                <% alert_color = 'warning' %>
              <% when 'accepted' %>
                <% alert_color = 'success' %>
              <% when 'refused' %>
                <% alert_color = 'danger' %>
              <% end %>
            <p> <span>Status:</span> <span class="alert-<%=alert_color%>"> <%= order.status%> </span> </p>
            <br>
            <p>Modify status:</p>

            <% Order::STATUSES.each do |status| %>
              <%= link_to change_status_order_path(order, status: status), method: :patch, class:"btn btn-light", remote: true do %>
                <%= status %>
              <% end %>
            <% end %>

          </div>
        </div>
      <% end %>
    </div>

    <br>
    <hr>
    <br>

    <div class="row">
      <h3>Books you orders</h3>
      <% @rentals.each do |rental| %>
        <div class="col-md-4 card-rental">
          <div class="order-card">
            <h5 class="text-center"> <%= rental.book.title %> </h5>
            <hr>
            <p> Renter: <%= rental.user.username %></p>
            <p> Message: <%= rental.message %></p>
            <p> Date: <%= rental.starting_date %> --> <%= rental.ending_date %></p>
            <hr>
              <% case rental.status %>
              <% when 'pending' %>
                <% alert_color = 'warning' %>
              <% when 'accepted' %>
                <% alert_color = 'success' %>
              <% when 'refused' %>
                <% alert_color = 'danger' %>
              <% end %>
            <p> <span>Status:</span> <span class="alert-<%=alert_color%>"> <%= rental.status%> </span> </p>
            <br>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
